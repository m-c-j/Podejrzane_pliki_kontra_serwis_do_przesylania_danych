{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card p-5 mt-4 text-center">
            <h3 class="mb-4">Wgraj nowy plik</h3>
            
            <form method="post" enctype="multipart/form-data">
                <div class="mb-3">
                    <input id="fileInput" class="form-control form-control-lg" type="file" name="file" required>

                    <div id="fileError" class="text-danger mt-2 fw-bold" style="display: none;">
                        ‚ùå Niepoprawny format pliku!
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <button id="submitBtn" type="submit" class="btn btn-success btn-lg">üöÄ Wy≈õlij plik na serwer</button>
                    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Anuluj</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // 1. Lista dozwolonych rozszerze≈Ñ (musi byƒá taka sama jak w Pythonie!)
    const allowedExtensions = ['txt', 'pdf', 'png', 'jpg', 'jpeg', 'gif', 'docx', 'zip', 'rar', '7z'];

    // 2. Pobieramy elementy ze strony
    const fileInput = document.getElementById('fileInput');
    const errorDiv = document.getElementById('fileError');
    const submitBtn = document.getElementById('submitBtn');

    // 3. Nas≈Çuchujemy zmiany (kiedy u≈ºytkownik wybierze plik)
    fileInput.addEventListener('change', function() {
        const filePath = this.value;

        // Je≈õli nic nie wybrano (np. anulowano), przerywamy
        if (!filePath) return;

        // WyciƒÖgamy rozszerzenie (to co po ostatniej kropce)
        const extension = filePath.split('.').pop().toLowerCase();

        // Sprawdzamy czy jest na li≈õcie
        if (allowedExtensions.includes(extension)) {
            // JEST OK: Ukryj b≈ÇƒÖd, w≈ÇƒÖcz przycisk
            errorDiv.style.display = 'none';
            submitBtn.disabled = false;
            submitBtn.classList.remove('btn-secondary');
            submitBtn.classList.add('btn-success');
            submitBtn.innerText = "Wy≈õlij plik na serwer";
        } else {
            // JEST ≈πLE: Poka≈º b≈ÇƒÖd, zablokuj przycisk
            errorDiv.style.display = 'block';
            errorDiv.innerText = `‚ùå Niepoprawny format pliku (.${extension})! Wybierz inny.`;

            submitBtn.disabled = true; // Blokuje klikanie
            submitBtn.classList.remove('btn-success');
            submitBtn.classList.add('btn-secondary'); // Szary kolor
            submitBtn.innerText = "‚õî Z≈Çy format pliku";
        }
    });
</script>
{% endblock %}